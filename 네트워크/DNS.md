# DNS

## 0. DNS 등장 배경

1. 초창기 인터넷 : ip 주소만 사용
   - 문제점
  
     1. ip주소는 사람들이 기억하기 어려움
     2. ip주소는 변경될 수 있음
     3. 인터넷이 커질 수록 관리가 어려움
2. HOSTS 파일 방식의 한계
   
     인터넷 초기에는 hosts.txt 라는 파일에 ip주소와 도메인 이름을 직접 매핑해서 관리했는데, 이렇게 관리하는 것은 서버가 ip 주소를 바꿀 경우, 업테이트가 늦어질 수 있고, 이름이 중복될 수도 있다는 문제점이 존재한다.

   ```
    172.217.169.110 google.com
    142.250.185.206 youtube.com
   ```

<br>

## 1. DNS란?
- 사람이 인식하기 쉬운 **도메인 이름을 서버가 인식하는 ip주소로 변환**하는 분산 데이터베이스 시스템
  
- DNS는 ```naver.com``` 과 같은 도메인 이름을 ip주소(```192.168.123.132```)로 변환해 브라우저가 인터넷 자원을 로드할 수 있도록 도와준다.
  - 도메인 이름 : 체계적인 문자로 표현한 호스트 이름
 
- DNS는 여러 개의 DNS 서버 (혹은 네임 서버)들로 구성된 분산 시스템
  - OSI 7계층 중, 애플리케이션 계층에서 동작하는 프로토콜
  - 기본적으로 UDP/53을 기반으로 사용하지만, 특수한 상황에서는 TCP/53도 사용한다.

<br>

### DNS의 전송 프로토콜
- UDP port 53
  - 일반 DNS 질의/응답에 사용
    
- TCP port 53
  
  1. 영역 전송(Zone Transfer)시, 사용
    - 안정성을 위해 두 개 이상의 DNS 서버를 사용할 경우, Master(기본 서버)와 Slave(보조 서버)간의 동기화가 필요한데,
    - 이때 기본 서버의 정보를 이용해 보조 서버의 데이터를 최신 상태로 업데이터 하는 작업을 **영역 전송**이라고 한다.
    - 마스터 서버와 슬레이브 서버를 동기화할 때, 마스터(Primary) 서버에서 변경된 DNS 데이터를 슬레이브(Secondary) 서버로 전송하여 두 서버의 데이터가 동일하게 유지되도록 한다.

  2. 용량이 큰 경우(512bytes 초과) 사용

<br>

## 3. DNS 구성 요소
DNS는 분산 시스템으로 도메인 이름을 분산하여 저장하는데 계층적 구조로 저장하고 관리한다.

- 도메인 네임 스페이스(Domain Name Space)라는 규칙으로 도메인 이름 저장을 분산한다.
  - DNS는 분산 시스템으로 도메인 이름을 분산하여 저장하는데 계층적 구조로 저장하고 관리한다.

- 네임 서버(Name Server) : 권한이 있는 DNS 서버
  - 해당 도메인의 ip주소를 찾는 역할 담당

- 리졸버(DNS Recursive Resolver) : 권한이 없는 DNS 서버
  - 클라이언트의 요청을 네임 서버로 전달하고, 찾은 정보를 클라이언트에게 제공하는 기능 담당
 
<br>

### (1) 도메인 네임 스페이스(Domain Name Space, 도메인 구조)
![Image](https://github.com/user-attachments/assets/4d103a26-dc04-464f-80cc-f93467b7d756)

- 인터넷 상에서 사용되는 도메인 : 전세계적으로 고유하게 존재하는 이름
  - 정해진 규칙 및 체계에 따라야 하고, 임의로 변경 및 생성될 수 없다.
  - 도메인의 체계적인 분류와 관리를 위해 도메인 이름은 몇 개의 짧은 영문자를 .으로 연결한 계층 구조를 가진다.
  - 트리에 연결된 호스트는 자원 레코드로 표현한다.

- DNS는 역트리 구조로 도메인을 관리하며, 도메인은 단계별로 계층적으로 구성되어 있다.

<br> 

#### 도메인 계층별 설명
1. 루트 도메인 (Root Domain)
   - 인터넷 도메인의 최상위 사작점(.)
   - 일반적으로 사용자는 직접 입력하지 않지만, DNS 내부적으로 최상위 도메인을 찾을 때 사용된다.
  
2. 1단계 도메인 (TLD, Top Level Domain = 최상위 도메인)
   - 루트 도메인 아래에 위치하는 최상위 도메인(TLD)
   - 국가명을 나타내는 국가 최상위 도메인과 일반적으로 사용되는 최상위 도메인으로 구분
     - 국가 최상위 도메인(ccTLD, country code TLD): kr, us, jp 등 (국가별 구분)
     - 일반 최상위 도메인(gTLD, generic TLD): com, org, net 등 (목적에 따라 구분)
  
3. 2단계 도메인 (SLD, Second Level Domain)
   - 최상위 도메인(TLD) 아래에 위치하며, 조직의 속성(기업이나 기관의 고유한 이름)을 구분한다.
   - 도메인의 중심이름!
   - 국가 도메인(ccTLD)에서는 co.kr (기업), go.kr (정부기관)처럼 사용된다.
   - 예: ```google.com```, ```naver.com```

4. 3단계 도메인
   - 조직이나 서비스의 이름을 나타내며, 사용자가 원하는 문자열을 설정할 수 있다.
   - 예: ```www.google.com```, ```blog.naver.com```

5. 호스트(Host)
   - 특정한 서비스를 제공하는 개별 서버를 나타낸다.
   - www, mail, ftp 등이 일반적으로 사용된다.
   - 도메인을 표기할 때는 낮은 단계부터 시작해서 최상위 도메인이 가장 뒤에 위치한다.
   - 예: ```www.naver.com``` (최상위 도메인 com이 마지막에 위치)

  
ex 1. www.google.com
  - . (Root Domain)      
  - com (1단계 도메인 = 최상위 도메인 = TLD(Top Level Domain))
  - google.com (2단계 도메인)
    - sld : google
  - www.google.com (서브 도메인 = 3단계 도메인)

ex 2. mail.google.co.kr
  - kr : 국가 최상위 도메인 (ccTLD)
  - co.kr : 기업용 2단계 도메인
  - google.co.kr : 기업의 3단계 도메인
    - sld : google (3단계 도메인 x)
      - gTLD에서는 회사명이나 사이트명, ccTLD에서는 기관 속성을 포함하기도 한다.
  - mail.google.co.kr : 서비스를 나타내는 4단계 도메인 (메일 서버)


<br>

### (2) 네임 서버 (DNS 서버)
- 도메인은 도메인 계층 구조를 반영한 DNS 서버(네임 서버)에 저장 및 관리한다.
  - 각 네임 서버는 도메인 계층의 일부 영역을 담당하고, 그 영역에 속한 도메인을 관리한다.
  - 상위 계층 네임 서버는 하위 계층의 도메인에 대한 정보를 관리하기 위해 하위 계층 네임 서버의 ip주소를 가지고 있다.
  - 최상위 계층인 루트 네임 서버의 ip주소는 모든 DNS 서버가 등록하여 관리한다. (길잡이 역할)
 
![Image](https://github.com/user-attachments/assets/fc89599d-6a18-4502-8329-77baa4a5b281)

- DNS 서버는 도메인 네임 스페이스를 위한 **권한 있는 DNS 서버**와 **권한 없는 DNS 서버**로 구분된다.
  - 권한 있는 DNS 서버
    1. Root DNS 서버
      - 최상위 네임 서버
      - ICANN(DNS 총괄 기구)애서 관리
      - 리졸버로부터 발생한 DNS 요청에 대한 적절한 TLD DNS 서버의 ip 주소를 제공하는 역할
      - ip주소로 변환하기 위한 첫 번째 단계로 책장의 색인과 같은 역할
    
    2. TLD DNS 서버
       - ```.com```, ```.net```, ```.kr```과 같은 top-level domain 별로 존재하는 DNS 서버로 도메인 등록 기관에서 관리
       - Root DNS 서버에서 받은 요청을 처리하는 서버
       - Authoritative DNS 서버의 ip주소를 제공하는 역할 (묶음으로 제공)
         
    3. Authoritative DNS 서버
       - 실제로 우리가 원하는 도메인에 대한 ip주소를 매핑하는 서버 (1:1)
       - 개인 도메인과 ip주소 관계가 저장되어 있음
       - 일반적으로 도메인/호스팅 업체의 네임 서버를 말함
         
  - 권한 없는 DNS 서버
    1. **Resolver 서버** = Local DNS 서버 = LSP DNS 서버 = Recursive DNS 서버
       - 질의를 통해 ip주소를 알아내거나 캐시
       - 대표적으로 KT/LG/SK와 같은 ISP(통신사) DNS 있고, 브라우저 우회 용도로 많이 쓰는 구글 DNS, 클라우드플레어와 같은 Public DNS 서버가 있음
       - **루트 → TLD → 권한 네임 서버** 순서로 내려가면서 질의
       - 도메인에 대한 질의를 받은 리졸버는 설정된 DNS 서버로 DNS Query(질의)를 전달하고, DNS 서버로부터 정보(도메인 이름, IP 주소)를 응답 받아 클라이언트에게 제공하는 기능을 수행

<br>

## DNS 작동 방식

<br>

## DNS Query

<br>

## DNS 레코드

<br>

## DNS 캐싱

<br>
