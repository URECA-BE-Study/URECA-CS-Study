# Redis

### Remote Dictionary Server

## 1. 개념

Redis는 **키-값(Key-Value)** 구조를 가진 **비관계형 데이터베이스(NoSQL)**로, **메모리 기반 데이터 처리**를 지원합니다. 주로 서버 환경에서 동작하며, **클라이언트-서버 아키텍처**를 따릅니다.

- **In-Memory** 기반: 메모리(DRAM)에서 데이터를 저장하고 처리하여 **빠른 속도** 제공
- 클라이언트는 Redis 서버에 접속하여 데이터를 읽고 쓰며, Redis는 프로세스로서 동작

Redis는 단순히 **캐시**로만 사용하는 것이 아니라, 다양한 데이터 구조와 고급 기능을 제공하는 **다목적 데이터베이스**로서 사용됩니다.

---

## 2. 특징

### 2.1 Key-Value 구조

Redis는 데이터가 **키-값** 형태로 저장되는 **비관계형** 데이터베이스로, 관계형 데이터베이스처럼 복잡한 쿼리 연산을 지원하지 않지만, 고속 읽기와 쓰기 처리에 최적화되어 있습니다.

### 2.2 In-Memory 솔루션

- **메모리 기반**으로 데이터를 처리해 빠른 속도 제공
- **다양한 데이터 구조체**를 지원:
  - **String, List, Set, Sorted Set, Hash** 등
  - 이를 통해 여러 용도에 맞는 최적화된 데이터 저장 및 관리가 가능합니다.
- 예를 들어, **리스트형 데이터 입력/삭제**는 MySQL에 비해 약 **10배 빠름**

### 2.3 영속성 보장

기본적으로 Redis는 **휘발성**이지만, 데이터를 디스크에 **스냅샷**하거나 **로그 방식**으로 영속성을 보장할 수 있는 옵션을 제공합니다:

- **RDB (Redis DataBase) 스냅샷**:
  - 주기적으로 데이터를 디스크에 저장하여 **백업** 및 **복구** 가능
  - 데이터 손실을 최소화하려는 환경에서 유용
- **AOF (Append-Only File)**:
  - 모든 쓰기 연산을 **로그 파일에 기록**하여 복구 정확성을 높임
  - 실시간 데이터 반영이 중요한 시스템에서 유용

### 2.4 싱글 쓰레드

- **싱글 스레드**로 동작하여 **한 번에 하나의 명령만 실행**
  - 멀티스레드에서 발생할 수 있는 **Context Switching** 비용을 줄여 **빠른 응답 속도**를 제공
  - **원자성(Atomicity)**을 보장하여 동시성 문제를 해결

---

## 3. Redis 사용 이유

### 3.1 다양한 자료구조 지원

Redis는 단순한 **Key-Value** 형태 외에도, 다양한 자료구조를 지원하여 실시간 데이터 처리에 적합한 환경을 제공합니다:

- **Sorted Set**: 정렬된 순서로 데이터를 저장하여 **빠른 조회** 및 **범위 검색**이 가능
- **Hash**: 여러 필드를 갖는 데이터를 한 번에 저장하여 **편리한 관리** 가능
- **Set**: 중복 없이 데이터를 저장하여 **집합 연산**에 유리

### 3.2 Atomic한 자료구조

Redis는 **Atomic한 연산**을 지원하여, **Race Condition**을 방지하고 안정적인 데이터 처리를 할 수 있습니다.

---

## 4. 고가용성 보장을 위한 Redis 아키텍처

### 4.1 Replication (복제)

- **Master-Slave 구조**를 통해 읽기 성능을 확장하고 데이터의 가용성을 높임
- **Slave 서버**는 **Master 서버**의 데이터를 복제하여 **읽기 작업을 분산 처리**함
- Master 서버에 장애가 발생해도, **Slave 서버**에서 데이터를 사용하여 서비스를 유지할 수 있음

### 4.2 Sentinel

Redis **Sentinel**은 Redis 서버의 **모니터링** 및 **자동 장애 조치(failover)** 기능을 제공합니다:

- **모니터링**: Redis 서버의 상태를 지속적으로 체크하고 장애를 감지
- **자동 장애 조치**: 장애 발생 시 자동으로 새로운 **Master 서버**를 선출하고, 클라이언트는 새로운 **Master 서버**를 사용
- **알림**: 시스템 관리자에게 장애 상황을 알림

### 4.3 Cluster

- **데이터 분산 저장** 및 **수평 확장성**을 지원하는 분산 데이터베이스 아키텍처
  - 데이터는 **여러 노드**에 분산 저장되며, **자동 리밸런싱**을 통해 데이터를 균형 있게 배치
  - 노드 추가로 클러스터 용량과 성능을 **확장 가능**

---

## 5. Redis와 Memcached 비교

| 항목                | Redis                               | Memcached                      |
|---------------------|-------------------------------------|--------------------------------|
| **자료 구조**       | 다양한 자료구조 지원               | String만 지원                 |
| **영속성**          | 지원 (RDB, AOF)                     | 영속성 미지원                  |
| **멀티 쓰레드**     | 싱글 스레드                         | 멀티 쓰레드                    |
| **복제**            | 지원 (Master-Slave)                | 지원하지 않음                  |
| **트랜잭션**         | 지원 (MULTI, EXEC)                 | 지원하지 않음                  |

Redis는 **다양한 기능**과 **고가용성**을 지원하는 반면, Memcached는 **단순 캐시**와 빠른 성능을 제공하는 **읽기 전용** 솔루션으로 사용됩니다.

---

## 6. Redis 활용 사례

- **세션 캐시** 및 **인증 토큰 저장**: Redis는 빠른 데이터 접근이 필요한 **세션 저장**에 적합
- **실시간 랭킹 시스템**: **Sorted Set**을 이용해 실시간으로 **랭킹**을 처리하고 사용자에게 빠르게 제공
- **메시지 대기열 시스템**: **Pub/Sub** 기능을 활용하여 실시간 메시징 및 알림 시스템 구축

---

## 7. 캐시(Cache)와 Redis

### 7.1 캐시 개념

캐시는 **데이터의 임시 저장소**로, 자주 요청되는 데이터를 **빠르게 제공**하기 위해 사용됩니다. Redis는 메모리 기반이므로 데이터 접근 속도가 매우 빠릅니다.

### 7.2 캐시 전략

- **캐시 일관성** 문제를 해결하기 위해 **캐시 쓰기 전략**과 **캐시 읽기 전략**을 사용하여 **성능 최적화**를 구현합니다.
  - **Write-through**: DB와 캐시를 동시에 갱신
  - **Write-back**: 캐시에서만 갱신 후 주기적으로 DB에 반영

---

## 8. Redis 사용 시 주의할 점

### 8.1 O(N) 시간복잡도 명령어 사용 지양

Redis는 **Single Thread** 서버이므로, **O(N)** 시간복잡도를 가진 명령어는 성능 저하를 일으킬 수 있습니다. Redis는 한 번에 하나의 명령만 처리하므로, 긴 실행 시간이 필요한 명령어는 전체 성능을 저하시킬 수 있습니다.

- **O(N)** 명령어 예시:
  - **keys**, **flushAll**, **flushDB**, **delete collections**, **get all collections**
  - **대체 명령어**: `keys` 대신 `scan` 명령어 사용

### 8.2 DEL 대신 UNLINK 사용

- **DEL** 명령어는 데이터를 삭제하는 동안 해당 키에 대한 작업을 **블로킹**하게 되어 성능 저하를 유발할 수 있습니다.
- **UNLINK** 명령어는 백그라운드에서 삭제를 처리하므로 **비동기적 삭제**가 가능하고, 성능에 미치는 영향을 줄일 수 있습니다.

### 8.3 캐시 만료 시간 설정

- **인메모리 DB**인 Redis는 메모리 크기가 제한적이므로, **키에 대한 만료 시간(Expire Time)**을 설정하는 것이 중요합니다. 이를 통해 메모리 과다 사용을 방지할 수 있습니다.

---

## 9. 참고 자료
- https://github.com/jmxx219/CS-Study/blob/main/database/Redis.md
