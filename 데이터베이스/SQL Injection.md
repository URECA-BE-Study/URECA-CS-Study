# SQL Injection
> 악의적인 사용자가 **보안 취약점을 이용하여 조작된 SQL 쿼리를 실행함**으로써 데이터 유출, 조작, 시스템 명령 실행, 인증 우회 등의 공격을 수행하는 기법

## 1. SQL Injection 공격 목적
### 정보 유출
- 데이터베이스에서 저장된 정보를 무단으로 조회

### 데이터 조작
- 데이터를 변경, 삭제, 삽입하여 시스템을 변조

### 원격 코드 실행
- 일부 DBMS의 확장 프로시저를 악용하여 원격 명령 실행
- 시스템 명령 실행 후 원격 접근 가능

### 인증 우회
- 로그인 폼에서 관리자 계정으로 인증 절차를 우회하여 로그인
- 공격자가 관리자 권한을 얻어 추가적인 피해 발생 가능

## 2. SQL Injection 발생 조건
### 사용자 입력값 검증 부족
- 사용자 입력값을 검증 또는 이스케이프(escape) 처리하지 않은 경우 발생

### 동적 SQL 쿼리 사용
- 사용자 입력값을 직접 포함하여 SQL 쿼리를 동적으로 생성할 때 발생

### 잘못된 실행 권한 설정
- 특정 사용자가 실행할 수 없는 SQL 명령을 허용했을 때 발생

## 3. SQL Injection 공격 기법
### 1) Error-Based SQL Injection
> 데이터베이스의 에러 메시지를 이용하여 정보를 유출하는 기법

#### 예시 (로그인 우회 공격)
```sql
SELECT * FROM users WHERE id = '1' 
AND (SELECT 1 FROM non_existing_table) = 1 --';
```

#### 결과 분석
- non_existing_table이 실제로 존재하지 않는다면 SQL 오류가 발생
- 반환된 에러 메시지를 통해 데이터베이스 유형과 구조를 유추 가능

### 2) UNION-Based SQL Injection
> UNION을 사용하여 공격자가 원하는 데이터를 조회하는 기법

#### 조건
- UNION하는 두 개의 SELECT문의 **컬럼 수, 데이터 타입**이 일치해야 함

#### 예시 (데이터베이스 테이블 조회)
```sql
SELECT username, password FROM users WHERE id = '1' 
UNION SELECT null, table_name FROM information_schema.tables --';
```

- 현재 데이터베이스에 존재하는 테이블 목록을 조회 가능
- 이후, columns 테이블을 조회하여 특정 테이블의 컬럼명을 유출할 수 있음

### 3) Boolean-Based SQL Injection
> SQL의 참/거짓(True/False) 결과를 기반으로 데이터를 추출하는 기법

#### 예시 (비밀번호 길이 확인)
```sql
SELECT username, password FROM users WHERE id = '1' 
AND LENGTH(password) > 10 --';
```

#### 결과 분석
- 응답이 정상적이면 → 비밀번호 길이가 10 초과
- 응답이 실패하면 → 비밀번호 길이가 10 이하
- 이를 반복하여 비밀번호 길이 및 값을 하나씩 추출 가능

### 4) Time-Based SQL Injection
> 서버 응답 시간을 기반으로 데이터를 추출하는 기법

#### 예시 (비밀번호 첫 글자 확인)
```sql
SELECT username, password FROM users WHERE id = '1' 
AND IF(SUBSTRING(password, 1, 1) = 'a', SLEEP(5), 0) --';
```

#### 결과 분석
- 비밀번호 첫 글자가 'a'라면 서버 응답이 5초 지연됨
- 이를 이용해 한 글자씩 추측 가능

## 4. SQL Injection 대응 방안
### 1) 화이트리스트 기반 검증
- 허용된 값만 입력 가능하도록 제한
- SQL 예약어, 특수문자 등을 포함한 입력 거부

### 2) Prepared Statement 사용
- 쿼리와 데이터를 분리하여 SQL Injection 방어
- 쿼리가 미리 컴파일되므로 공격자가 SQL 문법을 조작할 수 없음

### 3) 에러 메시지 최소화
- 데이터베이스 오류 메시지를 직접 출력하지 않음
- 공격자가 DB 구조를 파악하는 것을 방지

### 4) 웹 방화벽(WAF) 사용
- 웹 애플리케이션 방화벽(WAF)을 통해 SQL Injection 패턴 탐지 및 차단

### 5) 입력값 정규화
- 숫자만 입력 가능한 필드에는 숫자만 허용
- 예상된 데이터 유형과 다른 값이 입력되면 거부

### 6) 최소 권한 원칙 적용
- DB 사용자 계정에 최소한의 권한만 부여
- 예: 읽기 전용 계정을 사용하여 SELECT만 허용

### 7) 보안 업데이트 적용
- 데이터베이스, 웹 서버, 프레임워크 등을 최신 버전으로 유지

## 5. 블랙리스트 vs 화이트리스트
### 화이트리스트
#### 개념
- 엑세스 허용 목록
- 기본적으로 모든 접근을 막아놓고 접근 허용 대상만 따로 등록하는 방식
- 조직 내에서 신뢰할 수 있는 실행 파일, 응용 프로그램, 웹 사이트만 실행 가능하도록 허용

#### 장점
- 좀 더 엄격한 보안체계 구축 가능

#### 단점
- 보안 담당자에게 더 많은 업무 주어짐
- 특정 업무 시스템의 접근 권한을 통제하면, 자신도 등록해달라는 요청 발생

### 블랙리스트
#### 개념
- 엑세스 거부 목록
- 기본적으로 접근을 모두 허용하돼 접근하지 못하는 예외를 두는 방식

#### 특징
- 컴퓨터 보안에서 가장 오래된 알고리즘 중 하나
- 방화벽이나 백신 소프트웨어 등에 자주 사용

#### 장점
- 쉽고 빠른 보안 조치 가능
- 담당자의 노동이 적게 들어감

#### 단점
- 거부하지 않은 출처로부터 엑세스가 있는 경우 막기 어려움

> 보안적으로는 화이트리스트가 더 강력하지만, 운영 부담이 크므로 상황에 맞게 사용해야 함
